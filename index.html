<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login CBT</title>
<style>
* { box-sizing:border-box; font-family:Arial, sans-serif; }
body { margin:0; height:100vh; display:flex; justify-content:center; align-items:center;
      background: linear-gradient(rgba(0,0,0,0.35),rgba(0,0,0,0.35)), url("https://raw.githubusercontent.com/airnetcso/eps/main/image/bg.jpg") center/cover no-repeat; }
.login-box { width:360px; background:rgba(255,255,255,0.3); padding:30px 25px; text-align:center; backdrop-filter: blur(5px); }
.login-box h2 { margin-bottom:25px; color:#fff; }
.login-box input, .login-box select { width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; outline:none; font-size:14px; border-radius:5px; }
.login-box select { background:#fff; }
.login-box button { width:100%; padding:12px; background:#2563eb; color:#fff; border:none; font-size:15px; cursor:pointer; border-radius:5px; }
.login-box button:hover { background:#1e40af; }
#status-paket { color:#ffd700; font-weight:bold; margin-top:10px; font-size:13px; }
</style>
</head>
<body>

<div class="login-box">
  <h2>LOGIN UBT</h2>
  <input id="username" placeholder="Username / ì´ë¦„">
  <input id="password" type="password" placeholder="Password / ë¹„ë°€ë²ˆí˜¸">
  
  <select id="paket">
    <option value="">-- Pilih Paket Soal (Urut) --</option>
    <option value="1">ğŸ“š Paket 1 - Dasar</option>
    <option value="2">ğŸ“– Paket 2 - Variasi A</option>
    <option value="3">ğŸ“˜ Paket 3 - Variasi B</option>
    <option value="4">ğŸ“™ Paket 4 - Variasi C</option>
    <option value="5">ğŸ“• Paket 5 - Variasi D</option>
  </select>
  <div id="status-paket"></div>

  <button onclick="login()">LOGIN / ë¡œê·¸ì¸</button>
</div>

<script>
const users = [
  {username:"siswa01", password:"12345", role:"user"},
  {username:"siswa02", password:"12345", role:"user"},
  {username:"siswa03", password:"12345", role:"user"},
  {username:"admin",   password:"admin123", role:"admin"}
];

document.getElementById("paket").onchange = function() {
  cekStatusPaket();
};

function cekStatusPaket() {
  const paket = document.getElementById("paket").value;
  const status = document.getElementById("status-paket");
  
  if (!paket) {
    status.innerHTML = "";
    return;
  }
  
  if (bolehBukaPaket(paket)) {
    status.innerHTML = "âœ… <strong>Boleh dikerjakan</strong>";
    status.style.color = "#10b981";
  } else {
    status.innerHTML = "âŒ <strong>Harus lulus Paket " + (parseInt(paket)-1) + " (â‰¥70) dulu!</strong>";
    status.style.color = "#ef4444";
  }
}

function login() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const paket = document.getElementById("paket").value;

  if (!paket) {
    alert("Pilih paket soal terlebih dahulu!");
    return;
  }

  const user = users.find(x => x.username === u && x.password === p);
  if (!user) {
    alert("Username atau password salah!");
    return;
  }

  // Admin bypass semua aturan
  if (user.role === "admin") {
    localStorage.setItem("login", "true");
    localStorage.setItem("user", u);
    localStorage.setItem("role", user.role);
    localStorage.setItem("paketSoal", paket);
    location.href = "admin.html";
    return;
  }

  // User biasa: cek urutan paket
  if (!bolehBukaPaket(paket)) {
    alert("âŒ Harus selesaikan Paket " + (parseInt(paket)-1) + " dengan nilai â‰¥70 terlebih dahulu!");
    return;
  }

  localStorage.setItem("login", "true");
  localStorage.setItem("user", u);
  localStorage.setItem("role", user.role);
  localStorage.setItem("paketSoal", paket);

  location.href = "dashboard.html";
}

function bolehBukaPaket(paketStr) {
  const paket = parseInt(paketStr);
  if (paket === 1) return true; // Paket 1 selalu boleh

  const results = JSON.parse(localStorage.getItem("results") || "[]");
  const user = document.getElementById("username").value.trim();
  const prevPaket = (paket - 1).toString();
  
  const prevRecord = results.find(r => r.user === user && r.paket === prevPaket);
  return prevRecord && parseFloat(prevRecord.score) >= 70;
}
</script>
</body>
</html>