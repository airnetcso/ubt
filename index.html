<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEST BAHASA KOREA</title>
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f5f5f5}
/* LOGIN PAGE DENGAN ANIMASI */
#login-page{
 min-height:100vh;
 display:flex;
 flex-direction:column;
 justify-content:center;
 align-items:center;
 background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
 url('https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg') center/cover no-repeat;
}
/* ANIMASI MASUK HALUS */
@keyframes fadeSlideUp {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}
.login-container{
 width:90%;
 max-width:320px;
 padding:40px 30px;
 text-align:center;
 background:rgba(255,255,255,.12);
 backdrop-filter:blur(14px);
 border-radius:24px;
 box-shadow:0 12px 40px rgba(0,0,0,.5);
 animation: fadeSlideUp 0.9s ease-out forwards;
}
.login-container h1{
 color:#fff;font-size:28px;margin:0 0 8px 0;text-shadow:0 2px 6px rgba(0,0,0,.7);
}
.login-container h1:nth-of-type(2){font-size:24px;margin-bottom:20px;}
.login-container p{color:#eee;font-size:15px;margin-bottom:30px;}
input{
 width:100%;padding:16px;margin:12px 0;border:none;border-radius:14px;
 background:rgba(255,255,255,.18);color:#fff;font-size:16px;
 backdrop-filter:blur(4px);
 box-sizing:border-box;
 transition:all 0.3s;
}
input::placeholder{color:rgba(255,255,255,.65);}
input:focus{
 outline:none;background:rgba(255,255,255,.35);
 box-shadow:0 0 20px rgba(255,107,157,.6);
 transform:scale(1.02);
}
button{
 width:100%;padding:16px;margin:16px 0 8px;border:none;border-radius:14px;
 background:#ff6b9d;color:#fff;font-weight:bold;font-size:17px;cursor:pointer;
 box-shadow:0 6px 20px rgba(255,107,157,.5);
 transition:all 0.4s;
}
button:hover{
 background:#ff8ac1;
 transform:translateY(-5px) scale(1.05);
 box-shadow:0 12px 35px rgba(255,107,157,.7);
 animation: pulse 1.5s infinite;
}
@keyframes pulse {
 0%{box-shadow:0 6px 20px rgba(255,107,157,.5);}
 50%{box-shadow:0 12px 40px rgba(255,107,157,.9);}
 100%{box-shadow:0 6px 20px rgba(255,107,157,.5);}
}
.copyright{
 margin-top:35px;
 color:rgba(255,255,255,.8);
 font-size:13px;
 text-shadow:0 1px 4px rgba(0,0,0,.8);
}
/* QUIZ & RESULT - MOBILE FIRST */
#quiz-page{display:none;min-height:100vh;padding:70px 0 80px;background:linear-gradient(#fdf6ec,#f7efe2)}
.header-fixed{
 position:fixed;
 top:0;
 left:0;
 right:0;
 display:flex;
 justify-content:space-between;
 align-items:center;
 background:#fff;
 padding:10px 15px;
 box-shadow:0 2px 10px rgba(0,0,0,0.1);
 z-index:1000;
 box-sizing:border-box;
}
.timer, .submit-top{
 padding:12px 24px;
 text-align:center;
 color:#fff;
 font-weight:bold;
 font-size:16px;
 border-radius:0;
 min-width:110px;
}
.timer{background:#4caf50}
.submit-top{background:#f44336}
.container{
 max-width:540px;
 margin:auto;
 height:calc(100vh - 150px);
 overflow-y:auto;
 padding:0 15px;
 box-sizing:border-box;
}
.question-wrapper{
 display:none;
 margin-bottom:40px;
}
.question-wrapper.active{display:block}
/* GAMBAR & AUDIO: POLOS */
.box-passage{
 padding:0;
 margin-bottom:20px;
}
.box-passage audio,
.box-passage img{
 width:100%;
 margin-top:10px;
 display:block;
}
/* CUSTOM AUDIO PLAYER: KREM AGAK TUA + KOTAK (NO BORDER RADIUS) */
.box-passage audio{
 background:#e8d5b8;
 height:48px;
 border-radius:0 !important;
 box-shadow:0 2px 8px rgba(0,0,0,0.15);
}
.box-passage audio::-webkit-media-controls-panel {
 background-color:#e8d5b8 !important;
 border-radius:0 !important;
}
.box-passage audio::-webkit-media-controls-play-button,
.box-passage audio::-webkit-media-controls-volume-slider,
.box-passage audio::-webkit-media-controls-current-time-display,
.box-passage audio::-webkit-media-controls-time-remaining-display {
 color:#333;
}
.box-passage audio::-webkit-media-controls-timeline {
 background-color:#d4bea2;
 border-radius:0 !important;
}
/* SOAL & PILIHAN */
.box-question{
 background:#fff3e0;
 padding:20px;
 margin-top:15px;
}
.option-item{
 display:flex;
 align-items:center;
 margin:18px 0;
 font-size:16px;
}
.option-item input{display:none}
.option-circle{
 width:32px;
 height:32px;
 border:2px solid #333;
 border-radius:50%;
 display:flex;
 align-items:center;
 justify-content:center;
 margin-right:12px;
 flex-shrink:0;
 font-weight:bold;
 font-size:15px;
}
.option-item input:checked + .option-circle{
 background:#bbdefb;
 border-color:#2196f3;
 color:#2196f3;
}
.nav-bottom{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 display:flex;
 justify-content:space-between;
 align-items:center;
 background:#fff;
 padding:10px 15px;
 box-shadow:0 -2px 10px rgba(0,0,0,0.1);
 box-sizing:border-box;
}
.nav-bottom button{
 padding:12px 24px;
 text-align:center;
 color:#fff;
 border:none;
 font-weight:bold;
 font-size:16px;
 border-radius:0;
 min-width:110px;
}
#prev{background:#2196f3}
#next{background:#ff9800}
#result-page{display:none;max-width:600px;margin:auto;padding:20px 15px;}
.result-box{background:#fff;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
.wrong-item{margin-top:20px;padding:15px;background:#ffebee;border-left:5px solid #f44336;border-radius:8px;}
.correct{color:green;font-weight:bold}
.back-btn{
 margin-top:30px;
 padding:16px;
 background:#3f51b5;
 color:#fff;
 text-align:center;
 font-weight:bold;
 font-size:17px;
 border-radius:12px;
 cursor:pointer;
}
</style>
</head>
<body>

<div id="login-page">
 <div class="login-container">
 <h1>LATIHAN SOAL</h1>
 <h1>ÌïúÍµ≠Ïñ¥Ïó∞Ïäµ</h1>
 <p>25 Soal | 50 Menit</p>
 <input id="username" placeholder="Username / Ïù¥Î¶Ñ">
 <input id="password" type="password" placeholder="Password / ÎπÑÎ∞ÄÎ≤àÌò∏">
 <input id="kode" placeholder="Kode Soal / ÏãúÌóòÏΩîÎìú">
 <button id="btnLogin">LOGIN / Î°úÍ∑∏Ïù∏</button>
 </div>
 <div class="copyright">¬© 2026 Denzuka - Kim Jongun. All Rights Reserved.</div>
</div>

<div id="quiz-page">
 <div class="header-fixed">
  <div class="submit-top" id="submitTop">SUBMIT</div>
  <div class="timer" id="timer">50:00</div>
 </div>
 <div class="container"><form id="quiz-form"></form></div>
 <div class="nav-bottom">
  <button id="prev">PREV</button>
  <button id="next">NEXT</button>
 </div>
</div>

<div id="result-page">
 <div class="result-box" id="resultBox"></div>
</div>

<script>
const SPREADSHEET_URL = "https://script.google.com/macros/s/AKfycbzwdfNflhqIyVWo8knAyB2nWtzlkbPiRHfMCJV_O_mxkZravDprrAhMNV3Qu75WFYgk0g/exec";

const validCredentials = [
  {username: "Heri", password: "heri99"},
  {username: "hanarizka", password: "Nungkihana24!"},
  {username: "Fikrisurya", password: "464646"},
  {username: "Mutiara2003", password: "Mutiara14"},
  {username: "siwon", password: "kampus2"},
  {username: "wantikas", password: "200022"},
  {username: "uus", password: "123"},
  {username: "user01", password: "12345"},
  {username: "windi", password: "Windi2000"},
  {username: "yppsdi", password: "global2026"},
  {username: "rismaya97", password: "bahasakorea"},
  {username: "sita77", password: "minyooki"},
  {username: "Aini185", password: "Doraemon"},
  {username: "Hangeulfei", password: "studykorea02"},
  {username: "Hamdan106", password: "Fukuo106"},
  {username: "Dininidia", password: "dininidia11"},
  {username: "kaniarostayuni9", password: "Kania1313"},
  {username: "Dikisetiawan07", password: "Diki2709"},
  {username: "Aisyah18", password: "Aisyah18."},
  {username: "Rizka2026", password: "butterfly24"},
  {username: "Zhafif07", password: "20060722"},
  {username: "admin", password: "admin123"},
  {username: "koreafan", password: "hanguk789"},
  {username: "topik2026", password: "seoul2026"}
];

const kodeMapping = {
  "B12345": "soal1.json",
  "A09008": "soal2.json",
  "SAREWAE": "test.json",
  "W11765": "soal3.json",
  "H66666": "soal5.json"
};

const BASE = "https://raw.githubusercontent.com/airnetcso/latbakor/main/soal/";

let questions = [], answers = [], current = 0, time = 3000, interval;
let currentUser = "", currentKode = "";

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

document.addEventListener("DOMContentLoaded", () => {
  const loginPage = document.getElementById("login-page");
  const quizPage = document.getElementById("quiz-page");
  const resultPage = document.getElementById("result-page");
  const btnLogin = document.getElementById("btnLogin");
  const submitTop = document.getElementById("submitTop");
  const quizForm = document.getElementById("quiz-form");
  const timerEl = document.getElementById("timer");
  const resultBox = document.getElementById("resultBox");

  btnLogin.onclick = () => {
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    const k = document.getElementById("kode").value.trim().toUpperCase();

    // Cek credential dari array
    const userValid = validCredentials.find(cred => cred.username === u && cred.password === p);

    if (userValid && kodeMapping[k]) {
      currentUser = u;
      currentKode = k;
      loginPage.style.display = "none";
      quizPage.style.display = "block";
      loadSoal(kodeMapping[k]);
      startTimer();
    } else {
      alert("Username / Password / Kode salah");
    }
  };

  async function loadSoal(file) {
    let loadedQuestions = await (await fetch(BASE + file)).json();
    shuffle(loadedQuestions);
    questions = loadedQuestions;
    answers = Array(questions.length).fill(null);
    quizForm.innerHTML = "";
    questions.forEach((q, i) => {
      quizForm.innerHTML += `
      <div class="question-wrapper">
       <div class="box-passage">
        ${q.audio ? `<audio controls src="${q.audio}"></audio>` : ""}
        ${q.image ? `<img src="${q.image}">` : ""}
       </div>
       <div class="box-question">
        <p><b>${i + 1}.</b> ${q.question}</p>
        ${Object.entries(q.options).map(([k, v], idx) => `
        <label class="option-item">
         <input type="radio" name="q${i}" value="${k}">
         <span class="option-circle">${idx + 1}</span> ${v}
        </label>`).join("")}
       </div>
      </div>`;
    });
    document.querySelectorAll("input[type=radio]").forEach(r => {
      r.onchange = () => answers[+r.name.slice(1)] = r.value;
    });
    show(0);
  }

  function show(n) {
    document.querySelectorAll("audio").forEach(a => { a.pause(); a.currentTime = 0; });
    document.querySelectorAll(".question-wrapper").forEach((q, i) => q.classList.toggle("active", i === n));
    current = n;
  }

  document.getElementById("prev").onclick = () => current > 0 && show(current - 1);
  document.getElementById("next").onclick = () => current < questions.length - 1 && show(current + 1);

  submitTop.onclick = () => {
    const kosong = answers.findIndex(a => a === null);
    if (kosong !== -1) { alert("Soal " + (kosong + 1) + " belum dijawab"); show(kosong); return; }
    clearInterval(interval);
    quizPage.style.display = "none";
    resultPage.style.display = "block";
    let score = 0, html = "";
    questions.forEach((q, i) => {
      const benar = q.answer;
      if (answers[i] === benar) score += 4;
      else html += `
      <div class="wrong-item">
       <b>Soal ${i + 1} salah</b><br><br>
       Jawaban benar: <span class="correct">${benar}</span><br><br>
       ${q.explanation || "-"}
      </div>`;
    });
    const totalQuestions = questions.length;
    const percent = Math.round((score / (totalQuestions * 4)) * 100);
    const dataToSend = {
      waktu: new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' }),
      namaSiswa: currentUser || "Anonymous",
      code: currentKode || "Unknown",
      kosaKata: "-",
      ubt: "-",
      latihanSoal: `${score}/${totalQuestions * 4} (${percent}%)`,
      keterangan: html ? html.replace(/<[^>]+>/g, ' ').trim() : "Semua benar! Perfect!"
    };
    fetch(SPREADSHEET_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(dataToSend)
    })
    .then(res => res.json())
    .then(data => console.log("Data terkirim ke sheet:", data))
    .catch(err => {
      console.error("Gagal kirim ke sheet:", err);
      const params = new URLSearchParams(dataToSend);
      window.open(SPREADSHEET_URL + "?" + params.toString(), "_blank");
    });
    resultBox.innerHTML = `
     <h2>Nilai: ${score}</h2>
     ${html || "<p class='correct'>Semua jawaban benar üéâ</p>"}
     <div class="back-btn" onclick="location.reload()">KEMBALI</div>`;
  };

  function startTimer() {
    interval = setInterval(() => {
      timerEl.textContent = String(Math.floor(time / 60)).padStart(2, "0") + ":" + String(time % 60).padStart(2, "0");
      if (--time < 0) submitTop.onclick();
    }, 1000);
  }
});
</script>
</body>
</html>
